# 동적 프록시

이전 프록시 패턴을 사용했을 때, 클래스 수 만큼 프록시 클래스를 만들어야하는 단점을 확인할 수 있었다.
또한, 프록시 클래스들은 대부분 비슷한 코드를 공유하고 있는 모습으로 중복이 많다는 점도 단점이 될 수 있다.
하지만, 자바가 기본적으로 제공하는 `JDK 동적 프록시`나 `CGLIB` 같은 프록시 생성 기술을 활용하면 프록시 객체를 동적으로 생성할 수 있다.
즉, 프록시를 적용할 코드 하나만 만들어두고 프록시 객체를 찍어낼 수 있게되는 것이다.

## Reflection

동적 프록시를 이해하기 위해서는 사전에 리플렉션(Reflection) 기술을 이해해야한다.
리플렉션 기술은 클래스 또는 메서드의 메타정보를 동적으로 획득하고 코드 또한 동적으로 호출 가능한 기술이다.

- 장점
  - 클래스나 메서드 정보를 동적으로 변경할 수 있다.
  - `Class` 또는 `Method`라는 정보를 추상화를 통해 동적으로 제공할 수 있다.
- 주의
  - 런타임에 동작하기에 컴파일 시점에 오류를 잡을 수 없다
  - 즉 클래스 내 메서드 이름을 문자열로 적는데, 잘못 넣은 경우에도 컴파일이 되버림.
  - 따라서 일반적인 상황에서는 Reflection 은 사용하면 안된다

## JDK 동적 프록시

<p align="center"><img src="/img/jdk.png" width="80%"></p>
<p align="center"><img src="/img/jdk_1.png" width="80%"></p>

`인터페이스를 기반`으로 프록시 객체를 동적으로 런타임에 만들어준다.
JDK 동적 프록시에 적용할 로직은 `InvocationHandler` 인터페이스 구현해서 작성한다

- 파라미터
  - Object proxy : 프록시 자신
  - Method method : 호출할 메서드
  - Object[] args : 메서드 호출 시 파라미터 

JDK 동적 프록시는 인터페이스가 필수이기 때문에, 구현 클래스만 존재하는 경우 프록시를 적용할 수 없는 한계가 존재한다.

## CGLIB (Code Generate Library)

<p align="center"><img src="/img/cg.png" width="80%"></p>

인터페이스가 아니더라도 프록시를 적용할 수 있는 방법. `MehtodInterceptor`의 구현을 통해 작성한다

- 특징
  - 바이트코드를 조작해서 동적으로 클래스를 생성하는 기술을 제공한다
  - 인터페이스가 없어도 구체 클래스만 가지고 동적 프록시를 만들어 낼 수 있다.
  - 현재 스프링에서는 `ProxyFactory`라는 것이 이것을 편리하게 사용할 수 있다
  - JDK 동적 프록시는 구현(`implement`)을 통해 프록시를 만들고 CGLIB 은 상속(`extends`)을 통해 프록시를 만든다
- 제약
  - 상속을 통해 구현되기 때문에, 부모 클래스의 생성자를 체크해야한다
    - 즉, 자식 클래스를 동적으로 생성하기 떄문에 기본 생성자가 필요하다
  - 클래스에 `final` 키워드가 붙거나, 메서드에 `final`이 붙으면 상속 또는 오버라이딩이 불가능하다